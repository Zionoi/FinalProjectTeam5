<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상세정보</title>
    <link rel="stylesheet" th:href="@{/css/patientDetail.css}">
</head>
<body>
    <div class="details-container">
        <h1>상세정보</h1>
        <button class="edit-button" id="editBtn">수정버튼</button>
        <div class="patient-info">
            <!--<p>환자 이름: <span th:text="${patient.pName}">홍길동</span></p>-->
            <p>환자 ID: <span th:text="${patient.pid}">USER01</span></p>
            <p>생일: <span th:text="${patient.pBirthDate}">2000-12-31</span></p>
            <p>성별: <span th:text="${patient.pSex}">남</span></p>
            <p>코멘트: <span th:text="${patient.comments}">환자 상태 양호</span></p>
        </div>

        <!-- 코멘트 입력 폼 -->
        <div class="comment-section">
            <h2>코멘트 작성</h2>
            <form th:action="@{/patients/updateComment}" method="post" id="commentForm">
                <input type="hidden" th:name="pid" th:value="${patient.pid}">
                <textarea name="comments" rows="4" cols="50" placeholder="코멘트를 입력하세요"></textarea>
                <button type="submit">저장</button>
            </form>
        </div>

        <button class="back-button" id="backBtn">돌아가기</button>
    </div>

    <script th:src="@{/js/patientDetail.js}"></script>
    <script>
        document.getElementById('backBtn').addEventListener('click', function() {
            history.back(); // 이전 페이지로 돌아가기
        });

        // 폼이 제출되었을 때 팝업을 띄우는 스크립트
        document.getElementById('commentForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 기본 폼 제출 방지

            // 폼 데이터를 서버에 전송하기 위한 설정
            var formData = new FormData(this);

            fetch('/patients/updateComment', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // 성공적인 응답 후 팝업 표시
                if (data.success) {
                    alert('코멘트가 저장되었습니다!');
                } else {
                    alert('저장 중 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                alert('저장 중 오류가 발생했습니다.');
            });
        });
    </script>
</body>
</html>
